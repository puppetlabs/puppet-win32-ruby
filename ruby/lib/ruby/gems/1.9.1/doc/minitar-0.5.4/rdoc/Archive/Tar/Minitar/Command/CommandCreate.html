<?xml version="1.0" encoding="IBM437"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=IBM437" http-equiv="Content-Type" />

  <title>Class: Archive::Tar::Minitar::Command::CommandCreate</title>

  <link rel="stylesheet" href="../../../../rdoc.css" type="text/css" media="screen" />

  <script src="../../../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../../../index.html">Home</a>
          <a href="../../../../index.html#classes">Classes</a>
          <a href="../../../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../../../lib/archive/tar/minitar/command_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/archive/tar/minitar/command.rb">lib/archive/tar/minitar/command.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="CommandPattern.html">Archive::Tar::Minitar::Command::CommandPattern</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-altname">#altname</a></li>
          
          <li><a href="#method-i-call">#call</a></li>
          
          <li><a href="#method-i-help">#help</a></li>
          
          <li><a href="#method-i-name">#name</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../../../../ChangeLog.html">ChangeLog</a></li>
        
          <li class="file"><a href="../../../../Install.html">Install</a></li>
        
          <li class="file"><a href="../../../../README.html">README</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../../../Archive.html">Archive</a></li>
        
          <li><a href="../../../../Archive/Tar.html">Archive::Tar</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar.html">Archive::Tar::Minitar</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/BlockRequired.html">Archive::Tar::Minitar::BlockRequired</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/ClosedStream.html">Archive::Tar::Minitar::ClosedStream</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command.html">Archive::Tar::Minitar::Command</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandCreate.html">Archive::Tar::Minitar::Command::CommandCreate</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandExtract.html">Archive::Tar::Minitar::Command::CommandExtract</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandHelp.html">Archive::Tar::Minitar::Command::CommandHelp</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandList.html">Archive::Tar::Minitar::Command::CommandList</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandPattern.html">Archive::Tar::Minitar::Command::CommandPattern</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandPattern/AbstractCommandError.html">Archive::Tar::Minitar::Command::CommandPattern::AbstractCommandError</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandPattern/CommandAlreadyExists.html">Archive::Tar::Minitar::Command::CommandPattern::CommandAlreadyExists</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/CommandPattern/UnknownCommandError.html">Archive::Tar::Minitar::Command::CommandPattern::UnknownCommandError</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Command/ProgressBar.html">Archive::Tar::Minitar::Command::ProgressBar</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/FileNameTooLong.html">Archive::Tar::Minitar::FileNameTooLong</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Input.html">Archive::Tar::Minitar::Input</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/NonSeekableStream.html">Archive::Tar::Minitar::NonSeekableStream</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Output.html">Archive::Tar::Minitar::Output</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Reader.html">Archive::Tar::Minitar::Reader</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Reader/EntryStream.html">Archive::Tar::Minitar::Reader::EntryStream</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Reader/InvalidEntryStream.html">Archive::Tar::Minitar::Reader::InvalidEntryStream</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/UnexpectedEOF.html">Archive::Tar::Minitar::UnexpectedEOF</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Writer.html">Archive::Tar::Minitar::Writer</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Writer/BoundedStream.html">Archive::Tar::Minitar::Writer::BoundedStream</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Writer/BoundedStream/FileOverflow.html">Archive::Tar::Minitar::Writer::BoundedStream::FileOverflow</a></li>
        
          <li><a href="../../../../Archive/Tar/Minitar/Writer/RestrictedStream.html">Archive::Tar::Minitar::Writer::RestrictedStream</a></li>
        
          <li><a href="../../../../Archive/Tar/PosixHeader.html">Archive::Tar::PosixHeader</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Archive::Tar::Minitar::Command::CommandCreate</h1>

    <div id="description" class="description">
      
    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="altname-method" class="method-detail ">
          <a name="method-i-altname"></a>

          
          <div class="method-heading">
            <span class="method-name">altname</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="altname-source">
<pre>
<span class="ruby-comment"># File lib/archive/tar/minitar/command.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">altname</span>
  <span class="ruby-string">&quot;cr&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- altname-source -->
            
          </div>

          

          
        </div><!-- altname-method -->

      
        <div id="call-method" class="method-detail ">
          <a name="method-i-call"></a>

          
          <div class="method-heading">
            <span class="method-name">call</span><span
              class="method-args">(args, opts = {}, ioe = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="call-source">
<pre>
<span class="ruby-comment"># File lib/archive/tar/minitar/command.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-identifier">ioe</span> = {})
  <span class="ruby-identifier">argv</span>    = []

  <span class="ruby-keyword">while</span> (<span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span>)
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">'--compress'</span>, <span class="ruby-string">'-z'</span>
      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:compress</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Not enough arguments.\n\n&quot;</span>
    <span class="ruby-constant">CommandPattern</span>[<span class="ruby-string">&quot;help&quot;</span>][[<span class="ruby-string">&quot;create&quot;</span>]]
    <span class="ruby-keyword">return</span> <span class="ruby-value">255</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">output</span> = <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">shift</span>
  <span class="ruby-keyword">if</span> <span class="ruby-string">'-'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">output</span>
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>] = <span class="ruby-string">&quot;STDOUT&quot;</span>
    <span class="ruby-identifier">output</span> = <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:output</span>]
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:output</span>] = <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:error</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>] = <span class="ruby-identifier">output</span>
    <span class="ruby-identifier">output</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">output</span>, <span class="ruby-string">&quot;wb&quot;</span>)
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:output</span>] = <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:output</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\.tar\.gz$|\.tgz$/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:compress</span>]
    <span class="ruby-identifier">output</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">output</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;--&quot;</span>)
      <span class="ruby-comment"># Read stdin for the list of files.</span>
    <span class="ruby-identifier">files</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:input</span>].<span class="ruby-identifier">read</span> <span class="ruby-keyword">while</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">ioe</span>[<span class="ruby-value">:input</span>].<span class="ruby-identifier">eof?</span>
    <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\r\n|\n|\r/</span>)
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;--&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">to_a</span>
  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">flatten!</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:verbose</span>]
    <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">opts</span>[<span class="ruby-value">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{name}\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dir</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value">:file_done</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">opts</span>[<span class="ruby-value">:output</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span> }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:progress</span>]
    <span class="ruby-identifier">progress</span> = <span class="ruby-constant">ProgressBar</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>], <span class="ruby-value">1</span>)
    <span class="ruby-identifier">watcher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">stats</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">action</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:file_start</span>, <span class="ruby-value">:dir</span>
        <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">action</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dir</span>
          <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">total</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">stats</span>[<span class="ruby-value">:size</span>]
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:file_progress</span>
        <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">inc</span>(<span class="ruby-identifier">stats</span>[<span class="ruby-value">:currinc</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>]
      <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">finish</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">watcher</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">finisher</span> = <span class="ruby-identifier">lambda</span> { }
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Archive</span><span class="ruby-operator">::</span><span class="ruby-constant">Tar</span><span class="ruby-operator">::</span><span class="ruby-constant">Minitar</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-identifier">files</span>, <span class="ruby-identifier">output</span>, &amp;<span class="ruby-identifier">watcher</span>)
  <span class="ruby-identifier">finisher</span>.<span class="ruby-identifier">call</span>
  <span class="ruby-value">0</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">output</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">output</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">closed?</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- call-source -->
            
          </div>

          

          
        </div><!-- call-method -->

      
        <div id="help-method" class="method-detail ">
          <a name="method-i-help"></a>

          
          <div class="method-heading">
            <span class="method-name">help</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="help-source">
<pre>
<span class="ruby-comment"># File lib/archive/tar/minitar/command.rb, line 449</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">help</span>
  <span class="ruby-identifier">help</span> = <span class="ruby-string">    minitar create [OPTIONS] &lt;tarfile|-&gt; &lt;file|directory|--&gt;+Creates a new tarfile. If the tarfile is named .tar.gz or .tgz, then itwill be compressed automatically. If the tarfile is &quot;-&quot;, then it will beoutput to standard output (stdout) so that minitar may be piped.The files or directories that will be packed into the tarfile arespecified after the name of the tarfile itself. Directories will beprocessed recursively. If the token &quot;--&quot; is found in the list of filesto be packed, additional filenames will be read from standard input(stdin). If any file is not found, the packaging will be halted.create Options:    --compress, -z  Compresses the tarfile with gzip.</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- help-source -->
            
          </div>

          

          
        </div><!-- help-method -->

      
        <div id="name-method" class="method-detail ">
          <a name="method-i-name"></a>

          
          <div class="method-heading">
            <span class="method-name">name</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="name-source">
<pre>
<span class="ruby-comment"># File lib/archive/tar/minitar/command.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">name</span>
  <span class="ruby-string">&quot;create&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- name-source -->
            
          </div>

          

          
        </div><!-- name-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

