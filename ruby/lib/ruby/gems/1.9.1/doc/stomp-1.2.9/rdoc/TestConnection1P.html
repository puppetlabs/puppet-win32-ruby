<?xml version="1.0" encoding="IBM437"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=IBM437" http-equiv="Content-Type" />

  <title>Class: TestConnection1P</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./test/test_connection1p_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="test/test_connection1p.rb">test/test_connection1p.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link">Test::Unit::TestCase</p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-setup">#setup</a></li>
          
          <li><a href="#method-i-teardown">#teardown</a></li>
          
          <li><a href="#method-i-test_conn_11h_0060">#test_conn_11h_0060</a></li>
          
          <li><a href="#method-i-test_conn_1p_0000">#test_conn_1p_0000</a></li>
          
          <li><a href="#method-i-test_conn_1p_0010">#test_conn_1p_0010</a></li>
          
          <li><a href="#method-i-test_conn_1p_0020">#test_conn_1p_0020</a></li>
          
          <li><a href="#method-i-test_conn_1p_0030">#test_conn_1p_0030</a></li>
          
          <li><a href="#method-i-test_conn_1p_0040">#test_conn_1p_0040</a></li>
          
          <li><a href="#method-i-test_conn_1p_0050">#test_conn_1p_0050</a></li>
          
          <li><a href="#method-i-test_conn_1p_0070">#test_conn_1p_0070</a></li>
          
          <li><a href="#method-i-test_conn_1p_0080">#test_conn_1p_0080</a></li>
          
          <li><a href="#method-i-test_conn_1p_0090">#test_conn_1p_0090</a></li>
          
          <li><a href="#method-i-test_conn_1p_0100">#test_conn_1p_0100</a></li>
          
          <li><a href="#method-i-test_conn_1p_0110">#test_conn_1p_0110</a></li>
          
          <li><a href="#method-i-test_conn_1p_0120">#test_conn_1p_0120</a></li>
          
          <li><a href="#method-i-test_conn_1p_0124">#test_conn_1p_0124</a></li>
          
          <li><a href="#method-i-test_conn_1p_0127">#test_conn_1p_0127</a></li>
          
          <li><a href="#method-i-test_conn_1p_0130">#test_conn_1p_0130</a></li>
          
          <li><a href="#method-i-test_conn_1p_0135">#test_conn_1p_0135</a></li>
          
          <li><a href="#method-i-test_conn_1p_0140">#test_conn_1p_0140</a></li>
          
          <li><a href="#method-i-test_conn_1p_0200">#test_conn_1p_0200</a></li>
          
          <li><a href="#method-i-test_conn_1p_0210">#test_conn_1p_0210</a></li>
          
        </ul>
      </div>
      

      
      <!-- Included Modules -->
      <div id="includes-section" class="section">
        <h3 class="section-header">Included Modules</h3>
        <ul class="link-list">
        
        
          <li><a class="include" href="TestBase.html">TestBase</a></li>
        
        
        </ul>
      </div>
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./CHANGELOG_rdoc.html">CHANGELOG.rdoc</a></li>
        
          <li class="file"><a href="./LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="./README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./Stomp.html">Stomp</a></li>
        
          <li><a href="./Stomp/Client.html">Stomp::Client</a></li>
        
          <li><a href="./Stomp/Connection.html">Stomp::Connection</a></li>
        
          <li><a href="./Stomp/Error.html">Stomp::Error</a></li>
        
          <li><a href="./Stomp/Error/DuplicateSubscription.html">Stomp::Error::DuplicateSubscription</a></li>
        
          <li><a href="./Stomp/Error/InvalidFormat.html">Stomp::Error::InvalidFormat</a></li>
        
          <li><a href="./Stomp/Error/InvalidHeartBeatHeaderError.html">Stomp::Error::InvalidHeartBeatHeaderError</a></li>
        
          <li><a href="./Stomp/Error/InvalidMessageLength.html">Stomp::Error::InvalidMessageLength</a></li>
        
          <li><a href="./Stomp/Error/InvalidServerCommand.html">Stomp::Error::InvalidServerCommand</a></li>
        
          <li><a href="./Stomp/Error/LoggerConnectionError.html">Stomp::Error::LoggerConnectionError</a></li>
        
          <li><a href="./Stomp/Error/MaxReconnectAttempts.html">Stomp::Error::MaxReconnectAttempts</a></li>
        
          <li><a href="./Stomp/Error/MessageIDRequiredError.html">Stomp::Error::MessageIDRequiredError</a></li>
        
          <li><a href="./Stomp/Error/NoCurrentConnection.html">Stomp::Error::NoCurrentConnection</a></li>
        
          <li><a href="./Stomp/Error/PacketParsingTimeout.html">Stomp::Error::PacketParsingTimeout</a></li>
        
          <li><a href="./Stomp/Error/ProtocolErrorConnect.html">Stomp::Error::ProtocolErrorConnect</a></li>
        
          <li><a href="./Stomp/Error/SSLClientParamsError.html">Stomp::Error::SSLClientParamsError</a></li>
        
          <li><a href="./Stomp/Error/SSLNoCertFileError.html">Stomp::Error::SSLNoCertFileError</a></li>
        
          <li><a href="./Stomp/Error/SSLNoKeyFileError.html">Stomp::Error::SSLNoKeyFileError</a></li>
        
          <li><a href="./Stomp/Error/SSLNoTruststoreFileError.html">Stomp::Error::SSLNoTruststoreFileError</a></li>
        
          <li><a href="./Stomp/Error/SSLUnreadableCertFileError.html">Stomp::Error::SSLUnreadableCertFileError</a></li>
        
          <li><a href="./Stomp/Error/SSLUnreadableKeyFileError.html">Stomp::Error::SSLUnreadableKeyFileError</a></li>
        
          <li><a href="./Stomp/Error/SSLUnreadableTruststoreFileError.html">Stomp::Error::SSLUnreadableTruststoreFileError</a></li>
        
          <li><a href="./Stomp/Error/SocketOpenTimeout.html">Stomp::Error::SocketOpenTimeout</a></li>
        
          <li><a href="./Stomp/Error/StompServerError.html">Stomp::Error::StompServerError</a></li>
        
          <li><a href="./Stomp/Error/SubscriptionRequiredError.html">Stomp::Error::SubscriptionRequiredError</a></li>
        
          <li><a href="./Stomp/Error/UTF8ValidationError.html">Stomp::Error::UTF8ValidationError</a></li>
        
          <li><a href="./Stomp/Error/UnsupportedProtocolError.html">Stomp::Error::UnsupportedProtocolError</a></li>
        
          <li><a href="./Stomp/HeaderCodec.html">Stomp::HeaderCodec</a></li>
        
          <li><a href="./Stomp/Message.html">Stomp::Message</a></li>
        
          <li><a href="./Stomp/SSLParams.html">Stomp::SSLParams</a></li>
        
          <li><a href="./Client11Example1.html">Client11Example1</a></li>
        
          <li><a href="./Client11PutGet1.html">Client11PutGet1</a></li>
        
          <li><a href="./Connection11Example1.html">Connection11Example1</a></li>
        
          <li><a href="./Connection11Example2.html">Connection11Example2</a></li>
        
          <li><a href="./ExampleConsumer.html">ExampleConsumer</a></li>
        
          <li><a href="./ExamplePublisher.html">ExamplePublisher</a></li>
        
          <li><a href="./ExampleRubyCiphers.html">ExampleRubyCiphers</a></li>
        
          <li><a href="./ExampleSSL1.html">ExampleSSL1</a></li>
        
          <li><a href="./ExampleSSL1C.html">ExampleSSL1C</a></li>
        
          <li><a href="./ExampleSSL2.html">ExampleSSL2</a></li>
        
          <li><a href="./ExampleSSL2C.html">ExampleSSL2C</a></li>
        
          <li><a href="./ExampleSSL3.html">ExampleSSL3</a></li>
        
          <li><a href="./ExampleSSL3C.html">ExampleSSL3C</a></li>
        
          <li><a href="./ExampleSSL4.html">ExampleSSL4</a></li>
        
          <li><a href="./ExampleSSL4C.html">ExampleSSL4C</a></li>
        
          <li><a href="./ExampleTopicConsumer.html">ExampleTopicConsumer</a></li>
        
          <li><a href="./ExampleTopicPublisher.html">ExampleTopicPublisher</a></li>
        
          <li><a href="./Hash.html">Hash</a></li>
        
          <li><a href="./HeartBeatExample1.html">HeartBeatExample1</a></li>
        
          <li><a href="./LoggerExample.html">LoggerExample</a></li>
        
          <li><a href="./Object.html">Object</a></li>
        
          <li><a href="./Publish11Example1.html">Publish11Example1</a></li>
        
          <li><a href="./Receive11Example1.html">Receive11Example1</a></li>
        
          <li><a href="./Receive11Example2.html">Receive11Example2</a></li>
        
          <li><a href="./RepeatedHeadersExample.html">RepeatedHeadersExample</a></li>
        
          <li><a href="./SSLLoggerExample.html">SSLLoggerExample</a></li>
        
          <li><a href="./Slogger.html">Slogger</a></li>
        
          <li><a href="./Stomp11Common.html">Stomp11Common</a></li>
        
          <li><a href="./TestBase.html">TestBase</a></li>
        
          <li><a href="./TestClient.html">TestClient</a></li>
        
          <li><a href="./TestCodec.html">TestCodec</a></li>
        
          <li><a href="./TestConnection.html">TestConnection</a></li>
        
          <li><a href="./TestConnection1P.html">TestConnection1P</a></li>
        
          <li><a href="./TestMessage.html">TestMessage</a></li>
        
          <li><a href="./TestSSL.html">TestSSL</a></li>
        
          <li><a href="./Tlogger.html">Tlogger</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">TestConnection1P</h1>

    <div id="description" class="description">
      
<p>Main class for testing <a
href="Stomp/Connection.html">Stomp::Connection</a> instances, protocol
levels 1.1+.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="setup-method" class="method-detail ">
          <a name="method-i-setup"></a>

          
          <div class="method-heading">
            <span class="method-name">setup</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="setup-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 17</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup</span>
  <span class="ruby-ivar">@conn</span> = <span class="ruby-identifier">get_connection</span>()
<span class="ruby-keyword">end</span></pre>
            </div><!-- setup-source -->
            
          </div>

          

          
        </div><!-- setup-method -->

      
        <div id="teardown-method" class="method-detail ">
          <a name="method-i-teardown"></a>

          
          <div class="method-heading">
            <span class="method-name">teardown</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="teardown-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">teardown</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">open?</span> <span class="ruby-comment"># allow tests to disconnect</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- teardown-source -->
            
          </div>

          

          
        </div><!-- teardown-method -->

      
        <div id="test_conn_11h_0060-method" class="method-detail ">
          <a name="method-i-test_conn_11h_0060"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_11h_0060</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test malformed heartbeat header.</p>
            

            
            <div class="method-source-code" id="test_conn_11h_0060-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_11h_0060</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;a,10&quot;</span> <span class="ruby-comment"># Bad header Heartbeats</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_raise</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidHeartBeatHeaderError</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_11h_0060-source -->
            
          </div>

          

          
        </div><!-- test_conn_11h_0060-method -->

      
        <div id="test_conn_1p_0000-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0000"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0000</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test basic connection open.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0000-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0000</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">open?</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0000-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0000-method -->

      
        <div id="test_conn_1p_0010-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0010"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0010</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test missing connect headers.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0010-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0010</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = {<span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;localhost&quot;</span>}
  <span class="ruby-identifier">assert_raise</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">ProtocolErrorConnect</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-keyword">end</span>    
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">chb</span> = {<span class="ruby-string">&quot;accept-version&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;1.0&quot;</span>}
  <span class="ruby-identifier">assert_raise</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">ProtocolErrorConnect</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">chb</span>)
  <span class="ruby-keyword">end</span>    
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0010-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0010-method -->

      
        <div id="test_conn_1p_0020-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0020"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0020</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test requesting only a 1.0 connection.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0020-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 46</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0020</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = {<span class="ruby-value">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;localhost&quot;</span>, <span class="ruby-string">&quot;accept-version&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;1.0&quot;</span>}
  <span class="ruby-identifier">cha</span>[<span class="ruby-value">:host</span>] = <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">'STOMP_RABBIT'</span>]
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">protocol</span>, <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">SPL_10</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0020-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0020-method -->

      
        <div id="test_conn_1p_0030-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0030"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0030</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test requesting only a 1.1+ connection.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0030-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0030</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">SPL_11</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0030-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0030-method -->

      
        <div id="test_conn_1p_0040-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0040"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0040</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test basic request for no heartbeats.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0040-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0040</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;0,0&quot;</span> <span class="ruby-comment"># No heartbeats</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">SPL_11</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0040-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0040-method -->

      
        <div id="test_conn_1p_0050-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0050"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0050</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test malformed heartbeat header.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0050-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 87</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0050</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;10,10,20&quot;</span> <span class="ruby-comment"># Bad header Heartbeats</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_raise</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidHeartBeatHeaderError</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0050-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0050-method -->

      
        <div id="test_conn_1p_0070-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0070"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0070</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test a valid heartbeat header.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0070-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0070</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;500,1000&quot;</span> <span class="ruby-comment"># Valid heart beat headers</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">hbsend_interval</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">hbrecv_interval</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0070-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0070-method -->

      
        <div id="test_conn_1p_0080-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0080"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0080</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test only sending heartbeats.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0080-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0080</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;10000,0&quot;</span> <span class="ruby-comment"># Valid heart beat headers, send only</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">hb_asserts_send</span>(<span class="ruby-identifier">conn</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0080-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0080-method -->

      
        <div id="test_conn_1p_0090-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0090"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0090</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test only receiving heartbeats.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0090-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 144</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0090</span>
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
    <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;0,6000&quot;</span> <span class="ruby-comment"># Valid heart beat headers, receive only</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
<span class="ruby-comment">#      m = conn.receive # This will hang forever .....</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hb_asserts_recv</span>(<span class="ruby-identifier">conn</span>)
  <span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0090-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0090-method -->

      
        <div id="test_conn_1p_0100-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0100"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0100</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test sending and receiving heartbeats.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0100-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 163</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0100</span>
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
    <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;5000,10000&quot;</span> <span class="ruby-comment"># Valid heart beat headers, send and receive</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
<span class="ruby-comment">#      m = conn.receive # This will hang forever .....</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hb_asserts_both</span>(<span class="ruby-identifier">conn</span>)
  <span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0100-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0100-method -->

      
        <div id="test_conn_1p_0110-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0110"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0110</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test valid UTF8 data.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0110-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 182</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0110</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;0,0&quot;</span> <span class="ruby-comment"># No heartbeats</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-identifier">good_data</span> = [
    <span class="ruby-string">&quot;\x41\xc3\xb1\x42&quot;</span>,
    <span class="ruby-string">&quot;\xc2\x80&quot;</span>, <span class="ruby-comment"># 2 byte characters</span>
    <span class="ruby-string">&quot;\xc2\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xdf\x80&quot;</span>,
    <span class="ruby-string">&quot;\xdf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xe0\xa0\x80&quot;</span>, <span class="ruby-comment"># 3 byte characters</span>
    <span class="ruby-string">&quot;\xe0\xbf\x80&quot;</span>,
    <span class="ruby-string">&quot;\xe0\xa0\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xe0\xbf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xf1\x80\x80\x80&quot;</span>, <span class="ruby-comment"># 4 byte characters</span>
    <span class="ruby-string">&quot;\xf1\xbf\xbf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xf2\x80\x80\x80&quot;</span>,
    <span class="ruby-string">&quot;\xf2\xbf\xbf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xf3\x80\x80\x80&quot;</span>,
    <span class="ruby-string">&quot;\xf3\xbf\xbf\xbf&quot;</span>,
  ]
  <span class="ruby-identifier">good_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">string</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">valid_utf8?</span>(<span class="ruby-identifier">string</span>), <span class="ruby-node">&quot;good unicode specs 01: #{string}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0110-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0110-method -->

      
        <div id="test_conn_1p_0120-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0120"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0120</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test invalid UTF8 data.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0120-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0120</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;0,0&quot;</span> <span class="ruby-comment"># No heartbeats</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-identifier">bad_data</span> = [
    <span class="ruby-string">&quot;\x41\xc2\xc3\xb1\x42&quot;</span>,
    <span class="ruby-string">&quot;\xed\xa0\x80&quot;</span>, <span class="ruby-comment"># UTF-16 surrogate halves</span>
    <span class="ruby-string">&quot;\xed\xad\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xed\xae\x80&quot;</span>,
    <span class="ruby-string">&quot;\xed\xaf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xed\xb0\x80&quot;</span>,
    <span class="ruby-string">&quot;\xed\xbe\x80&quot;</span>,
    <span class="ruby-string">&quot;\xed\xbf\xbf&quot;</span>,
    <span class="ruby-string">&quot;\xc0&quot;</span>, <span class="ruby-comment"># Single bytes</span>
    <span class="ruby-string">&quot;\xc1&quot;</span>,
    <span class="ruby-string">&quot;\xf5&quot;</span>,<span class="ruby-string">&quot;\xf6&quot;</span>,<span class="ruby-string">&quot;\xf7&quot;</span>,<span class="ruby-string">&quot;\xf8&quot;</span>,<span class="ruby-string">&quot;\xf9&quot;</span>,<span class="ruby-string">&quot;\xfa&quot;</span>,<span class="ruby-string">&quot;\xfb&quot;</span>,<span class="ruby-string">&quot;\xfc&quot;</span>,
    <span class="ruby-string">&quot;\xfd&quot;</span>,<span class="ruby-string">&quot;\xfe&quot;</span>,<span class="ruby-string">&quot;\xff&quot;</span>,
    <span class="ruby-string">&quot;\xc0\x80&quot;</span>, <span class="ruby-comment"># Not shortest representation</span>
    <span class="ruby-string">&quot;\xc1\x80&quot;</span>,
    <span class="ruby-string">&quot;\xc0\x30&quot;</span>,
    <span class="ruby-string">&quot;\xc1\x30&quot;</span>,
    <span class="ruby-string">&quot;\xe0\x80\x80&quot;</span>,
    <span class="ruby-string">&quot;\xf0\x80\x80\x80&quot;</span>,
  ]
  <span class="ruby-identifier">bad_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">string</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">conn</span>.<span class="ruby-identifier">valid_utf8?</span>(<span class="ruby-identifier">string</span>), <span class="ruby-node">&quot;bad unicode specs 01: #{string}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0120-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0120-method -->

      
        <div id="test_conn_1p_0124-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0124"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0124</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Repeated headers test. Currently:</p>
<ul><li>
<p>Apollo emits repeated headers for a 1.1 connection only</p>
</li><li>
<p>RabbitMQ does not emit repeated headers under any circumstances</p>
</li><li>
<p>AMQ 5.6 does not emit repeated headers under any circumstances</p>
</li></ul>

<p>Pure luck that this runs against AMQ at present.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0124-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 251</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0124</span>
  <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">make_destination</span>
  <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;payload: #{Time.now.to_f}&quot;</span>
  <span class="ruby-identifier">shdrs</span> = { <span class="ruby-string">&quot;key1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;val1&quot;</span>, <span class="ruby-string">&quot;key2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;val2&quot;</span>,
    <span class="ruby-string">&quot;key3&quot;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;kv3&quot;</span>, <span class="ruby-string">&quot;kv2&quot;</span>, <span class="ruby-string">&quot;kv1&quot;</span>] }
  <span class="ruby-identifier">assert_nothing_raised</span> {
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">publish</span> <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">shdrs</span>
  }
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">sid</span> = <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">uuid</span>()
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">subscribe</span> <span class="ruby-identifier">dest</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sid</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">received</span> = <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">receive</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">received</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">SPL_10</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">shdrs</span>[<span class="ruby-string">&quot;key3&quot;</span>], <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;key3&quot;</span>] <span class="ruby-keyword">unless</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">'STOMP_RABBIT'</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">'STOMP_AMQ11'</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;kv3&quot;</span>, <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;key3&quot;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">unsubscribe</span> <span class="ruby-identifier">dest</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sid</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0124-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0124-method -->

      
        <div id="test_conn_1p_0127-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0127"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0127</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test frozen headers.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0127-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0127</span>
  <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">make_destination</span>
  <span class="ruby-identifier">sid</span> = <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">uuid</span>()
  <span class="ruby-identifier">sid</span>.<span class="ruby-identifier">freeze</span>
  <span class="ruby-identifier">assert_nothing_raised</span> {
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">subscribe</span> <span class="ruby-identifier">dest</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sid</span>
  }
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0127-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0127-method -->

      
        <div id="test_conn_1p_0130-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0130"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0130</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test heartbeats with send and receive.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0130-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 285</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0130</span>
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
    <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;10000,6000&quot;</span> <span class="ruby-comment"># Valid heart beat headers, send and receive</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
<span class="ruby-comment">#      m = conn.receive # This will hang forever .....</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hb_asserts_both</span>(<span class="ruby-identifier">conn</span>)
  <span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0130-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0130-method -->

      
        <div id="test_conn_1p_0135-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0135"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0135</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test heartbeats with send and receive.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0135-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 304</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0135</span>
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
    <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;10000,1000&quot;</span> <span class="ruby-comment"># Valid heart beat headers, send and receive</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
<span class="ruby-comment">#      m = conn.receive # This will hang forever .....</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hb_asserts_both</span>(<span class="ruby-identifier">conn</span>)
  <span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0135-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0135-method -->

      
        <div id="test_conn_1p_0140-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0140"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0140</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test heartbeats with send and receive.</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0140-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 323</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0140</span>
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
    <span class="ruby-identifier">cha</span>[<span class="ruby-string">&quot;heart-beat&quot;</span>] = <span class="ruby-string">&quot;1000,10000&quot;</span> <span class="ruby-comment"># Valid heart beat headers, send and receive</span>
    <span class="ruby-identifier">conn</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">logger</span> = <span class="ruby-constant">Tlogger</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
<span class="ruby-comment">#      m = conn.receive # This will hang forever .....</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-identifier">logger</span>)
      <span class="ruby-identifier">sleep</span> <span class="ruby-value">65</span>
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">set_logger</span>(<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">hb_asserts_both</span>(<span class="ruby-identifier">conn</span>)
  <span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0140-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0140-method -->

      
        <div id="test_conn_1p_0200-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0200"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0200</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test very basic encoding / decoding of headers</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0200-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 342</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0200</span>
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">disconnect</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">cha</span> = <span class="ruby-identifier">get_conn_headers</span>()    
  <span class="ruby-identifier">conn</span> = <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">5</span>, <span class="ruby-identifier">cha</span>)
  <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;payload: #{Time.now.to_f}&quot;</span>
  <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">make_destination</span>
  <span class="ruby-identifier">shdrs</span> = { <span class="ruby-string">&quot;ab:cd&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;ef:gh&quot;</span>, <span class="ruby-string">&quot;a\nb&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;c\nd&quot;</span>, <span class="ruby-string">&quot;x\\y&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;z\\s&quot;</span> }
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">protocol</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">SPL_12</span>
    <span class="ruby-identifier">shdrs</span>[<span class="ruby-string">&quot;bb\rcc&quot;</span>] = <span class="ruby-string">&quot;dd\ree&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_nothing_raised</span> {
    <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">publish</span> <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">shdrs</span>
  }
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">uuid</span>()
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">subscribe</span> <span class="ruby-identifier">dest</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sid</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">received</span> = <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">receive</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">received</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">shdrs</span>.<span class="ruby-identifier">each_pair</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">k</span>), <span class="ruby-node">&quot;Key not found: #{k}&quot;</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">has_value?</span>(<span class="ruby-identifier">v</span>), <span class="ruby-node">&quot;Value not found: #{v}&quot;</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">v</span>, <span class="ruby-node">&quot;Mismatch: #{k},#{v}&quot;</span>
  }
  <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">disconnect</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0200-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0200-method -->

      
        <div id="test_conn_1p_0210-method" class="method-detail ">
          <a name="method-i-test_conn_1p_0210"></a>

          
          <div class="method-heading">
            <span class="method-name">test_conn_1p_0210</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Test that 1.1+ connections do not break suppress_content_length (Issue #52)</p>
            

            
            <div class="method-source-code" id="test_conn_1p_0210-source">
<pre>
<span class="ruby-comment"># File test/test_connection1p.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_conn_1p_0210</span>
  <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;payload: #{Time.now.to_f}&quot;</span>
  <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">make_destination</span>
  <span class="ruby-identifier">shdrs</span> = { <span class="ruby-value">:suppress_content_length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }
  <span class="ruby-identifier">assert_nothing_raised</span> {
    <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">publish</span> <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">shdrs</span>
  }
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">sid</span> = <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">uuid</span>()
  <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">subscribe</span> <span class="ruby-identifier">dest</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sid</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">received</span> = <span class="ruby-ivar">@conn</span>.<span class="ruby-identifier">receive</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">received</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">received</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;content-length&quot;</span>], <span class="ruby-string">&quot;No content length expected.&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- test_conn_1p_0210-source -->
            
          </div>

          

          
        </div><!-- test_conn_1p_0210-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

