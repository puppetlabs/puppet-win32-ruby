<?xml version="1.0" encoding="IBM437"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=IBM437" http-equiv="Content-Type" />

  <title>Module: DeepMerge</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./lib/deep_merge/core_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/deep_merge/core.rb">lib/deep_merge/core.rb</a></li>
          
            <li><a href="./lib/deep_merge/deep_merge_hash_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/deep_merge/deep_merge_hash.rb">lib/deep_merge/deep_merge_hash.rb</a></li>
          
            <li><a href="./lib/deep_merge/rails_compat_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/deep_merge/rails_compat.rb">lib/deep_merge/rails_compat.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      

      

      
      <!-- Namespace Contents -->
      <div id="namespace-list-section" class="section">
        <h3 class="section-header">Namespace</h3>
        <ul class="link-list">
          
          <li><span class="type">MODULE</span> <a href="DeepMerge/DeepMergeHash.html">DeepMerge::DeepMergeHash</a></li>
          
          <li><span class="type">MODULE</span> <a href="DeepMerge/RailsCompat.html">DeepMerge::RailsCompat</a></li>
          
          <li><span class="type">CLASS</span> <a href="DeepMerge/InvalidParameter.html">DeepMerge::InvalidParameter</a></li>
          
        </ul>
      </div>
      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-clear_or_nil">::clear_or_nil</a></li>
          
          <li><a href="#method-c-deep_merge-21">::deep_merge!</a></li>
          
          <li><a href="#method-c-overwrite_unmergeables">::overwrite_unmergeables</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./README.html">README</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./DeepMerge.html">DeepMerge</a></li>
        
          <li><a href="./DeepMerge/DeepMergeHash.html">DeepMerge::DeepMergeHash</a></li>
        
          <li><a href="./DeepMerge/InvalidParameter.html">DeepMerge::InvalidParameter</a></li>
        
          <li><a href="./DeepMerge/RailsCompat.html">DeepMerge::RailsCompat</a></li>
        
          <li><a href="./Hash.html">Hash</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">DeepMerge</h1>

    <div id="description" class="description">
      
    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      
      <!-- Constants -->
      <div id="constants-list" class="section">
        <h3 class="section-header">Constants</h3>
        <dl>
        
          <dt><a name="DEFAULT_FIELD_KNOCKOUT_PREFIX">DEFAULT_FIELD_KNOCKOUT_PREFIX</a></dt>
          
          <dd class="description"></dd>
          
        
        </dl>
      </div>
      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="clear_or_nil-method" class="method-detail ">
          <a name="method-c-clear_or_nil"></a>

          
          <div class="method-heading">
            <span class="method-name">clear_or_nil</span><span
              class="method-args">(obj)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="clear_or_nil-source">
<pre>
<span class="ruby-comment"># File lib/deep_merge/core.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">clear_or_nil</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:clear</span>)
    <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">obj</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">obj</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- clear_or_nil-source -->
            
          </div>

          

          
        </div><!-- clear_or_nil-method -->

      
        <div id="deep_merge-21-method" class="method-detail ">
          <a name="method-c-deep_merge-21"></a>

          
          <div class="method-heading">
            <span class="method-name">deep_merge!</span><span
              class="method-args">(source, dest, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Deep Merge core documentation. deep_merge! method permits merging of
arbitrary child elements. The two top level elements must be hashes. These
hashes can contain unlimited (to stack limit) levels of child elements.
These child elements to not have to be of the same types. Where child
elements are of the same type, deep_merge will attempt to merge them
together. Where child elements are not of the same type, deep_merge will
skip or optionally overwrite the destination element with the contents of
the source element at that level. So if you have two hashes like this:</p>

<pre>source = {:x =&gt; [1,2,3], :y =&gt; 2}
dest =   {:x =&gt; [4,5,'6'], :y =&gt; [7,8,9]}
dest.deep_merge!(source)
Results: {:x =&gt; [1,2,3,4,5,'6'], :y =&gt; 2}</pre>

<p>By default, "deep_merge!" will overwrite any unmergeables and merge
everything else. To avoid this, use "deep_merge" (no bang/exclamation mark)</p>

<p>Options:</p>

<pre>Options are specified in the last parameter passed, which should be in hash format:
hash.deep_merge!({:x =&gt; [1,2]}, {:knockout_prefix =&gt; '--'})
:preserve_unmergeables  DEFAULT: false
   Set to true to skip any unmergeable elements from source
:knockout_prefix        DEFAULT: nil
   Set to string value to signify prefix which deletes elements from existing element
:sort_merged_arrays     DEFAULT: false
   Set to true to sort all arrays that are merged together
:unpack_arrays          DEFAULT: nil
   Set to string value to run &quot;Array::join&quot; then &quot;String::split&quot; against all arrays
:merge_hash_arrays      DEFAULT: false
   Set to true to merge hashes within arrays
:merge_debug            DEFAULT: false
   Set to true to get console output of merge process for debugging</pre>

<p>Selected Options Details: :knockout_prefix =&gt; The purpose of this is to
provide a way to remove elements</p>

<pre>from existing Hash by specifying them in a special way in incoming hash
 source = {:x =&gt; ['--1', '2']}
 dest   = {:x =&gt; ['1', '3']}
 dest.ko_deep_merge!(source)
 Results: {:x =&gt; ['2','3']}
Additionally, if the knockout_prefix is passed alone as a string, it will cause
the entire element to be removed:
 source = {:x =&gt; '--'}
 dest   = {:x =&gt; [1,2,3]}
 dest.ko_deep_merge!(source)
 Results: {:x =&gt; &quot;&quot;}</pre>

<p>:unpack_arrays =&gt; The purpose of this is to permit compound elements to
be passed</p>

<pre>in as strings and to be converted into discrete array elements
irsource = {:x =&gt; ['1,2,3', '4']}
dest   = {:x =&gt; ['5','6','7,8']}
dest.deep_merge!(source, {:unpack_arrays =&gt; ','})
Results: {:x =&gt; ['1','2','3','4','5','6','7','8'}
Why: If receiving data from an HTML form, this makes it easy for a checkbox
 to pass multiple values from within a single HTML element</pre>

<p>:merge_hash_arrays =&gt; merge hashes within arrays</p>

<pre>source = {:x =&gt; [{:y =&gt; 1}]}
dest   = {:x =&gt; [{:z =&gt; 2}]}
dest.deep_merge!(source, {:merge_hash_arrays =&gt; true})
Results: {:x =&gt; [{:y =&gt; 1, :z =&gt; 2}]}</pre>

<p>There are many tests for this library - and you can learn more about the
features and usages of deep_merge! by just browsing the test examples</p>
            

            
            <div class="method-source-code" id="deep_merge-21-source">
<pre>
<span class="ruby-comment"># File lib/deep_merge/core.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">deep_merge!</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-comment"># turn on this line for stdout debugging text</span>
  <span class="ruby-identifier">merge_debug</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:merge_debug</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">overwrite_unmergeable</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:preserve_unmergeables</span>]
  <span class="ruby-identifier">knockout_prefix</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:knockout_prefix</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidParameter</span>, <span class="ruby-string">&quot;knockout_prefix cannot be an empty string in deep_merge!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">knockout_prefix</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidParameter</span>, <span class="ruby-string">&quot;overwrite_unmergeable must be true if knockout_prefix is specified in deep_merge!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">knockout_prefix</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">overwrite_unmergeable</span>
  <span class="ruby-comment"># if present: we will split and join arrays on this char before merging</span>
  <span class="ruby-identifier">array_split_char</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:unpack_arrays</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-comment"># request that we sort together any arrays when they are merged</span>
  <span class="ruby-identifier">sort_merged_arrays</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:sort_merged_arrays</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-comment"># request that arrays of hashes are merged together</span>
  <span class="ruby-identifier">merge_hash_arrays</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:merge_hash_arrays</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">di</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug_indent</span>] <span class="ruby-operator">||</span> <span class="ruby-string">''</span>
  <span class="ruby-comment"># do nothing if source is nil</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">dest</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment"># if dest doesn't exist, then simply copy source to it</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">dest</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">overwrite_unmergeable</span>
    <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">source</span>; <span class="ruby-keyword">return</span> <span class="ruby-identifier">dest</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}Source class: #{source.class.inspect} :: Dest class: #{dest.class.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}Hashes: #{source.inspect} :: #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
    <span class="ruby-identifier">source</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">src_key</span>, <span class="ruby-identifier">src_value</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} looping: #{src_key.inspect} =&gt; #{src_value.inspect} :: #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">src_key</span>]
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} ==&gt;merging: #{src_key.inspect} =&gt; #{src_value.inspect} :: #{dest[src_key].inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
          <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">src_key</span>] = <span class="ruby-identifier">deep_merge!</span>(<span class="ruby-identifier">src_value</span>, <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">src_key</span>], <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:debug_indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">di</span> <span class="ruby-operator">+</span> <span class="ruby-string">'  '</span>))
        <span class="ruby-keyword">else</span> <span class="ruby-comment"># dest[src_key] doesn't exist so we want to create and overwrite it (but we do this via deep_merge!)</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} ==&gt;merging over: #{src_key.inspect} =&gt; #{src_value.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
          <span class="ruby-comment"># note: we rescue here b/c some classes respond to &quot;dup&quot; but don't implement it (Numeric, TrueClass, FalseClass, NilClass among maybe others)</span>
          <span class="ruby-keyword">begin</span>
            <span class="ruby-identifier">src_dup</span> = <span class="ruby-identifier">src_value</span>.<span class="ruby-identifier">dup</span> <span class="ruby-comment"># we dup src_value if possible because we're going to merge into it (since dest is empty)</span>
          <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TypeError</span>
            <span class="ruby-identifier">src_dup</span> = <span class="ruby-identifier">src_value</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">src_key</span>] = <span class="ruby-identifier">deep_merge!</span>(<span class="ruby-identifier">src_value</span>, <span class="ruby-identifier">src_dup</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:debug_indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">di</span> <span class="ruby-operator">+</span> <span class="ruby-string">'  '</span>))
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span> <span class="ruby-comment"># dest isn't a hash, so we overwrite it completely (if permitted)</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">overwrite_unmergeable</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}  overwriting dest: #{src_key.inspect} =&gt; #{src_value.inspect} -over-&gt;  #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
          <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">overwrite_unmergeables</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">options</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}Arrays: #{source.inspect} :: #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
    <span class="ruby-comment"># if we are instructed, join/split any source arrays before processing</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">array_split_char</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} split/join on source: #{source.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-identifier">source</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">array_split_char</span>).<span class="ruby-identifier">split</span>(<span class="ruby-identifier">array_split_char</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
        <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">array_split_char</span>).<span class="ruby-identifier">split</span>(<span class="ruby-identifier">array_split_char</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># if there's a naked knockout_prefix in source, that means we are to truncate dest</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">knockout_prefix</span>)
      <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">clear_or_nil</span>(<span class="ruby-identifier">dest</span>); <span class="ruby-identifier">source</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">knockout_prefix</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">knockout_prefix</span>
        <span class="ruby-identifier">print</span> <span class="ruby-node">&quot;#{di} knocking out: &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
        <span class="ruby-comment"># remove knockout prefix items from both source and dest</span>
        <span class="ruby-identifier">source</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ko_item</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">retval</span> = <span class="ruby-keyword">false</span>
          <span class="ruby-identifier">item</span> = <span class="ruby-identifier">ko_item</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:gsub</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">ko_item</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">%{^#{knockout_prefix}}</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">ko_item</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">ko_item</span>
            <span class="ruby-identifier">print</span> <span class="ruby-node">&quot;#{ko_item} - &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
            <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">item</span>)
            <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">ko_item</span>)
            <span class="ruby-identifier">retval</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">retval</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} merging arrays: #{source.inspect} :: #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-identifier">source_all_hashes</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) }
      <span class="ruby-identifier">dest_all_hashes</span> = <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>) }
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_hash_arrays</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">source_all_hashes</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">dest_all_hashes</span>
        <span class="ruby-comment"># merge hashes in lists</span>
        <span class="ruby-identifier">list</span> = []
        <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">list</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">deep_merge!</span>(<span class="ruby-identifier">source</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">||</span> {}, <span class="ruby-identifier">dest</span>[<span class="ruby-identifier">i</span>],
                                <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:debug_indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">di</span> <span class="ruby-operator">+</span> <span class="ruby-string">'  '</span>))
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">list</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">source</span>[<span class="ruby-identifier">dest</span>.<span class="ruby-identifier">count</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">count</span>
        <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">list</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">dest</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">source</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">dest</span>.<span class="ruby-identifier">sort!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sort_merged_arrays</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">overwrite_unmergeable</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di} overwriting dest: #{source.inspect} -over-&gt; #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">overwrite_unmergeables</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span> <span class="ruby-comment"># src_hash is not an array or hash, so we'll have to overwrite dest</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}Others: #{source.inspect} :: #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
    <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">overwrite_unmergeables</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}Returning #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
  <span class="ruby-identifier">dest</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- deep_merge-21-source -->
            
          </div>

          

          
        </div><!-- deep_merge-21-method -->

      
        <div id="overwrite_unmergeables-method" class="method-detail ">
          <a name="method-c-overwrite_unmergeables"></a>

          
          <div class="method-heading">
            <span class="method-name">overwrite_unmergeables</span><span
              class="method-args">(source, dest, options)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>allows deep_merge! to uniformly handle overwriting of unmergeable entities</p>
            

            
            <div class="method-source-code" id="overwrite_unmergeables-source">
<pre>
<span class="ruby-comment"># File lib/deep_merge/core.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">overwrite_unmergeables</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">merge_debug</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:merge_debug</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">overwrite_unmergeable</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:preserve_unmergeables</span>]
  <span class="ruby-identifier">knockout_prefix</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:knockout_prefix</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">di</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:debug_indent</span>] <span class="ruby-operator">||</span> <span class="ruby-string">''</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">knockout_prefix</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">overwrite_unmergeable</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-comment"># remove knockout string from source before overwriting dest</span>
      <span class="ruby-identifier">src_tmp</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">%{^#{knockout_prefix}}</span>,<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-comment"># remove all knockout elements before overwriting dest</span>
      <span class="ruby-identifier">src_tmp</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">ko_item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ko_item</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ko_item</span>.<span class="ruby-identifier">match</span>(<span class="ruby-node">%{^#{knockout_prefix}}</span>) }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">src_tmp</span> = <span class="ruby-identifier">source</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">src_tmp</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">source</span> <span class="ruby-comment"># if we didn't find a knockout_prefix then we just overwrite dest</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}#{src_tmp.inspect} -over-&gt; #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">src_tmp</span>
    <span class="ruby-keyword">else</span> <span class="ruby-comment"># if we do find a knockout_prefix, then we just delete dest</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{di}\&quot;\&quot; -over-&gt; #{dest.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">merge_debug</span>
      <span class="ruby-identifier">dest</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">overwrite_unmergeable</span>
    <span class="ruby-identifier">dest</span> = <span class="ruby-identifier">source</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">dest</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- overwrite_unmergeables-source -->
            
          </div>

          

          
        </div><!-- overwrite_unmergeables-method -->

      
      </div><!-- public-class-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

